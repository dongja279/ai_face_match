<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI ê´€ìƒê¶í•©</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
  .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  h1 { text-align: center; margin-bottom: 10px; }
  p { text-align: center; color: #555; font-size: 0.9rem; }

  .preview-section { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; }
  .preview-box { flex: 1; aspect-ratio: 3/4; background: #0b1220; border-radius: 8px; overflow: hidden; position: relative; display: flex; align-items: center; justify-content: center; }
  .preview-box img { width: 100%; height: 100%; object-fit: cover; }
  .upload-btn { width: 80%; position: absolute; background: linear-gradient(135deg,#6ea8ff,#7c6dff); color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; bottom: 8px; left: 50%; transform: translateX(-50%); opacity: 0.95; }

  .button-group { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
  button { font-size: 1rem; font-weight: bold; padding: 12px; border: none; border-radius: 8px; cursor: pointer; }
  .analyze-btn { background: linear-gradient(135deg,#6ea8ff,#7c6dff); color: white; }
  .copy-btn { background: #059669; color: white; }

  .result { font-size:15.5px; line-height:1.7; letter-spacing:.1px; white-space: pre-line; padding: 15px; border-radius: 8px; margin-top: 20px; background: #0b1220; color: #eef4ff; }
</style>
</head>
<body>
<div class="container">
  <h1>AI ê´€ìƒê¶í•©</h1>
  <p>ë‘ ì‚¬ëŒì˜ ì–¼êµ´ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´, ì‹¬ì¸µ ê¶í•© ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤. (ì¬ë¯¸ë¡œë§Œ ë³´ì„¸ìš”!)</p>

  <div class="preview-section">
    <div class="preview-box" id="previewA">
      <input type="file" id="imgA" accept="image/*" style="display:none" onchange="showPreview('A')">
      <button class="upload-btn" onclick="document.getElementById('imgA').click()">A ì‚¬ì§„ ì—…ë¡œë“œ</button>
    </div>
    <div class="preview-box" id="previewB">
      <input type="file" id="imgB" accept="image/*" style="display:none" onchange="showPreview('B')">
      <button class="upload-btn" onclick="document.getElementById('imgB').click()">B ì‚¬ì§„ ì—…ë¡œë“œ</button>
    </div>
  </div>

  <div class="button-group">
    <button class="analyze-btn" onclick="analyze()">ğŸ”® ê´€ìƒê¶í•© ë¶„ì„í•˜ê¸°</button>
    <button class="copy-btn" onclick="copyResult()">ğŸ“‹ ë¶„ì„ ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>
  </div>

  <div id="status"></div>
  <div id="result" class="result"></div>

  <p style="text-align:center; font-size:0.85rem; color:#888; margin-top:20px;">
    ğŸ“§ ë¬¸ì˜: <a href="mailto:dongja279@gmail.com" style="color:#888;">dongja279@gmail.com</a>
  </p>
</div>

<script>
function showPreview(target) {
  const fileInput = document.getElementById('img' + target);
  const previewBox = document.getElementById('preview' + target);
  if (fileInput.files && fileInput.files[0]) {
    const reader = new FileReader();
    reader.onload = e => {
      previewBox.innerHTML = `<img src="${e.target.result}" alt="${target} ë¯¸ë¦¬ë³´ê¸°">
      <input type="file" id="img${target}" accept="image/*" style="display:none" onchange="showPreview('${target}')">
      <button class="upload-btn" onclick="document.getElementById('img${target}').click()">${target} ì‚¬ì§„ ì—…ë¡œë“œ</button>`;
    };
    reader.readAsDataURL(fileInput.files[0]);
  }
}

async function analyze() {
  const imgAInput = document.getElementById('imgA');
  const imgBInput = document.getElementById('imgB');
  if (!imgAInput || !imgBInput || !imgAInput.files.length || !imgBInput.files.length) {
    alert('ë‘ ì¥ì˜ ì‚¬ì§„ì„ ëª¨ë‘ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
    return;
  }

  const imgAFile = imgAInput.files[0];
  const imgBFile = imgBInput.files[0];
  document.getElementById('status').innerText = 'ë¶„ì„ ì¤‘...';

  const imgAData = await toBase64(imgAFile);
  const imgBData = await toBase64(imgBFile);

  const res = await fetch('/api/match', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ imgA: imgAData, imgB: imgBData })
  });
  const data = await res.json();
  document.getElementById('status').innerText = '';
  document.getElementById('result').innerText = formatResult(data);
}

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

function formatResult(d) {
  const lines = [];
  lines.push(`âœ¨ ê¶í•© ì ìˆ˜: ${d.score ?? '?'} / 100`);
  if (d.score_reason) lines.push(`(ì ìˆ˜ ê·¼ê±°) ${d.score_reason}`);
  if (d.person1) {
    lines.push('\nğŸ‘¤ Aì˜ ê´€ìƒ íŠ¹ì§•');
    for (let [key, val] of Object.entries(d.person1)) {
      if (val && key !== 'analysis') lines.push(`- ${val}`);
    }
    if (d.person1.analysis) lines.push(`- í’€ì´: ${d.person1.analysis}`);
  }
  if (d.person2) {
    lines.push('\nğŸ‘¤ Bì˜ ê´€ìƒ íŠ¹ì§•');
    for (let [key, val] of Object.entries(d.person2)) {
      if (val && key !== 'analysis') lines.push(`- ${val}`);
    }
    if (d.person2.analysis) lines.push(`- í’€ì´: ${d.person2.analysis}`);
  }
  if (d.compatibility) {
    lines.push('\nâ€”â€” ê¶í•© í•´ì„ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”');
    if (d.compatibility.summary) lines.push(d.compatibility.summary);
    if (d.compatibility.strengths) lines.push(`\nğŸ¤ ì˜ ë§ëŠ” ì :\n- ${d.compatibility.strengths.join('\n- ')}`);
    if (d.compatibility.cautions) lines.push(`\nâš ï¸ ì¡°ì‹¬í•´ì•¼ í•  ì :\n- ${d.compatibility.cautions.join('\n- ')}`);
    if (d.compatibility.tips) lines.push(`\nğŸ’¡ Tip:\n- ${d.compatibility.tips.join('\n- ')}`);
  }
  lines.push('\n(â€» ì˜¤ë½/ì°¸ê³ ìš© ê²°ê³¼ì…ë‹ˆë‹¤. ì‚¬ì§„ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)');
  return lines.join('\n');
}

function copyResult() {
  const resultText = document.getElementById('result').innerText;
  navigator.clipboard.writeText(resultText).then(() => {
    alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
  });
}
</script>
</body>
</html>
