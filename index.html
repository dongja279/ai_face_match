<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI ê´€ìƒê¶í•©</title>
<style>
  :root{
    --bg:#0f1220; --panel:#11162a; --ink:#e8eef7; --muted:#9fb0c6;
    --line:#1e263a; --accent:#7c5cff; --accent2:#22d3ee; --chip:#0d1222;
    --good:#10b981; --btn:#0b1324;
  }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  header{margin-bottom:14px}
  h1{margin:0 0 6px;font-size:28px}
  .sub{color:var(--muted)}
  .grid{display:grid;gap:16px}
  @media(min-width:900px){.grid{grid-template-columns:340px 1fr}}
  .card{background:linear-gradient(180deg,var(--panel),#0e1427);border:1px solid var(--line);border-radius:16px;padding:16px}
  .card h2{margin:0 0 12px;font-size:16px;color:#cfe1ff}
  .uploader{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .slot{background:#0b1222;border:1px dashed #304061;border-radius:14px;min-height:220px;display:flex;align-items:flex-end;justify-content:center;padding:14px;position:relative;overflow:hidden}
  .slot img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
  input[type=file]{display:none}
  .btn{border:1px solid #2a3654;background:linear-gradient(135deg,#324064,#29324b);color:#eaf2ff;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer;width:88%;text-align:center}
  .primary{background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:#fff}
  .primary:disabled{opacity:.6}
  .act{display:grid;gap:10px;margin-top:14px}
  .bar{height:6px;border-radius:999px;background:#0a1221;border:1px solid #1b2a45;overflow:hidden}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,#22d3ee,#7c5cff,#22c55e)}
  .muted{color:var(--muted)}
  .pill{display:inline-block;background:#0f1a30;border:1px solid #253356;color:#b6c7e6;padding:4px 8px;border-radius:999px;font-size:12px}
  .list{margin:6px 0 0 0;padding-left:18px}
  .section{background:#0d1326;border:1px solid #1d2947;border-radius:14px;padding:14px;margin:14px 0}
  .who h4{margin:0 0 8px}
  .pair{display:grid;gap:10px}
  @media(min-width:760px){.pair{grid-template-columns:1fr 1fr}}
  footer{margin-top:18px;color:#a9bad7}
  a.email{color:#cfe1ff}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>AI ê´€ìƒê¶í•©</h1>
    <div class="sub">ë‘ ì‚¬ëŒì˜ ì–¼êµ´ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´, ì‹¬ì¸µ ê¶í•© ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤. (ì¬ë¯¸ë¡œë§Œ ë³´ì„¸ìš”!)</div>
  </header>

  <div class="grid">
    <!-- ì¢Œ: ì—…ë¡œë“œ -->
    <section class="card">
      <h2>ì‚¬ì§„ ì—…ë¡œë“œ</h2>
      <div class="uploader">
        <div class="slot">
          <img id="imgPrevA" alt="" style="display:none" />
          <input id="fileA" type="file" accept="image/*">
          <button id="btnA" class="btn" type="button">ğŸ§‘ A ì‚¬ì§„ ì—…ë¡œë“œ</button>
        </div>
        <div class="slot">
          <img id="imgPrevB" alt="" style="display:none" />
          <input id="fileB" type="file" accept="image/*">
          <button id="btnB" class="btn" type="button">ğŸ‘© B ì‚¬ì§„ ì—…ë¡œë“œ</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="bar"><div id="bar"></div></div>
        <div id="status" class="muted" style="margin-top:6px">ëŒ€ê¸° ì¤‘â€¦</div>
      </div>

      <div class="act">
        <button id="analyze" class="primary btn" type="button">ğŸ”® ê´€ìƒê¶í•© ë¶„ì„í•˜ê¸°</button>
        <button id="shareBtn" class="btn" type="button">ğŸ“‹ ë¶„ì„ ê²°ê³¼ ë³µì‚¬í•˜ê¸°(ë§í¬)</button>
      </div>
    </section>

    <!-- ìš°: ê²°ê³¼ -->
    <section class="card">
      <h2>ê²°ê³¼</h2>
      <div id="out" class="muted">ì•„ì§ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      <div id="shareCta" style="display:none;margin-top:8px" class="act">
        <a class="primary btn" href="/" style="text-decoration:none;text-align:center">ë¬´ë£Œë¡œ AI ê´€ìƒ ê¶í•©</a>
      </div>
    </section>
  </div>

  <footer>ë¬¸ì˜: <a class="email" href="mailto:dongja279@gmail.com">dongja279@gmail.com</a></footer>
</div>

<script>
  const fileA=document.getElementById('fileA'), fileB=document.getElementById('fileB');
  const btnA=document.getElementById('btnA'), btnB=document.getElementById('btnB');
  const imgPrevA=document.getElementById('imgPrevA'), imgPrevB=document.getElementById('imgPrevB');
  const analyze=document.getElementById('analyze'), out=document.getElementById('out');
  const bar=document.getElementById('bar'), statusEl=document.getElementById('status');
  const shareBtn=document.getElementById('shareBtn'), shareCta=document.getElementById('shareCta');
  let imgA=null, imgB=null, busy=false, lastResult=null;

  btnA.onclick=()=>fileA.click(); btnB.onclick=()=>fileB.click();
  fileA.onchange=()=>preview(fileA, imgPrevA, v=>imgA=v);
  fileB.onchange=()=>preview(fileB, imgPrevB, v=>imgB=v);

  function preview(inp, imgEl, setter){
    const f = inp.files?.[0]; if(!f) return;
    const r = new FileReader();
    r.onload = e => { setter(e.target.result); imgEl.src=e.target.result; imgEl.style.display='block'; };
    r.readAsDataURL(f);
  }

  function setBusy(b, msg){
    busy=b;
    statusEl.textContent = b ? (msg || 'ë¶„ì„ì¤‘..') : 'ë¶„ì„ì™„ë£Œ!';
    bar.style.width = b ? '70%' : '100%';
    analyze.disabled = b; btnA.disabled=b; btnB.disabled=b;
  }

  analyze.onclick = async ()=>{
    if(!imgA || !imgB){ alert('A, B ì‚¬ì§„ì„ ëª¨ë‘ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.'); return; }
    try{
      setBusy(true,'ë¶„ì„ì¤‘..');
      out.innerHTML = '<div class="muted">AIê°€ ê´€ìƒ ë¶„ì„ ì¤‘â€¦</div>';

      const r = await fetch('/api/match',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ imgA, imgB })
      });
      if(!r.ok) throw new Error(await r.text());
      const d = await r.json();
      lastResult = d;
      out.innerHTML = renderHTML(d);
    }catch(e){
      out.innerHTML = `<div class="section">ì—ëŸ¬: ${e?.message||e}</div>`;
    }finally{
      setBusy(false,'ë¶„ì„ì™„ë£Œ!');
    }
  };

  // reason/verdict/tips UI
  const fblock = (title, obj)=>{
    if(!obj) return '';
    const R = s => (s ?? '').toString();
    const L = a => (Array.isArray(a)?a:[a]).filter(Boolean).map(x=>`<li>${R(x)}</li>`).join('');
    return `
      <div style="margin-top:10px">
        <div class="pill">${title}</div>
        ${obj.reason ? `<div style="margin-top:6px"><b>ê·¼ê±°:</b> ${R(obj.reason)}</div>` : ''}
        ${obj.verdict ? `<div style="margin-top:6px"><b>ê²°ë¡ :</b> ${R(obj.verdict)}</div>` : ''}
        ${obj.tips ? `<ul class="list">${L(obj.tips)}</ul>` : ''}
      </div>`;
  };

  function person(label, p){
    const F = p?.fortune || {};
    return `
    <div class="who section">
      <h4>${label}</h4>
      ${fblock('ì¬ë¬¼ìš´', F.wealth)}
      ${fblock('ì—°ì• ìš´', F.love)}
      ${fblock('ê±´ê°•ìš´', F.health)}
    </div>`;
  }

  function compat(title, data){
    const R = s => (s ?? '').toString();
    const L = a => (Array.isArray(a)?a:[a]).filter(Boolean).map(x=>`<li>${R(x)}</li>`).join('');
    return `
      <div class="section">
        <div class="pill">${title} ${R(data?.score)}ì </div>
        <div style="margin-top:8px"><b>ì˜ ë§ëŠ” ì </b></div>
        <ul class="list">${L(data?.strengths)}</ul>
        <div style="margin-top:8px"><b>ì¡°ì‹¬í•´ì•¼ í•  ì </b></div>
        <ul class="list">${L(data?.cautions)}</ul>
      </div>`;
  }

  function renderHTML(d){
    return `
    <div class="section" style="background:#0b162d">
      <div class="pill">âœ¨ ê¶í•© ìš”ì•½</div>
      <div class="muted" style="margin-top:6px">ë¶„ì„ì™„ë£Œ! ì•„ë˜ì—ì„œ ê°œì¸ ìš´ì„¸ ê·¼ê±°ì™€ ê¶í•© í•´ì„ì„ í™•ì¸í•˜ì„¸ìš”.</div>
    </div>
    <div class="pair">
      ${person('A', d.personA)}
      ${person('B', d.personB)}
    </div>
    ${compat('ğŸ’– ì—°ì• /ìš°ì •', d?.compatibility?.love_friendship)}
    ${compat('ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤', d?.compatibility?.business)}
    `;
  }

  // ê³µìœ (ì§§ì€ ë§í¬)
  shareBtn.onclick = async ()=>{
    try{
      if(!lastResult){ alert('ë¨¼ì € ë¶„ì„ì„ ì™„ë£Œí•´ ì£¼ì„¸ìš”.'); return; }
      const r = await fetch('/api/share', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ result: lastResult })
      });
      if(!r.ok) throw new Error(await r.text());
      const { id } = await r.json();
      const url = `${location.origin}/v?id=${id}`;
      await navigator.clipboard.writeText(url);
      shareBtn.textContent = 'âœ… ë§í¬ ë³µì‚¬ë¨';
      setTimeout(()=> shareBtn.textContent='ğŸ“‹ ë¶„ì„ ê²°ê³¼ ë³µì‚¬í•˜ê¸°(ë§í¬)', 1200);
      if(navigator.share){ try{ await navigator.share({ title:'AI ê´€ìƒê¶í•© ê²°ê³¼', url }); }catch{} }
    }catch(e){ alert('ë§í¬ ë³µì‚¬ ì‹¤íŒ¨: '+(e?.message||e)); }
  };

  // ê³µìœ  ë§í¬ë¡œ ì§„ì…í•˜ë©´ ê²°ê³¼ ë Œë”
  (function bootFromShare(){
    const id = new URLSearchParams(location.search).get('id');
    if(!id) return;
    fetch(`/api/get?id=${encodeURIComponent(id)}`)
      .then(r=> r.ok ? r.json() : Promise.reject('not found'))
      .then(data=>{
        lastResult=data;
        document.getElementById('shareCta').style.display='grid';
        document.querySelector('.uploader').style.display='none';
        out.innerHTML = renderHTML(data);
        statusEl.textContent = 'ë¶„ì„ì™„ë£Œ!';
        bar.style.width = '100%';
      })
      .catch(()=>{});
  })();
</script>
</body>
</html>

<!-- updated for ê´€ìƒ ê·¼ê±° -->

