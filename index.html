<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI ê´€ìƒê¶í•©</title>
<style>
  /* ===== Color tokens (ëŒ€ë¹„ ê°•í™”) ===== */
  :root{
    --bg:#070b13;
    --panel:#0d1422;
    --panel2:#0a111d;
    --ink:#ffffff;              /* ë³¸ë¬¸: ìˆœë°± */
    --muted:#d6e2f5;            /* ë³´ì¡°: ë” ì§„í•˜ê²Œ */
    --line:#203050;
    --chip:#152540;
    --g1:#7c3aed; --g2:#06b6d4; --ok:#16a085;
    --shadow:0 10px 28px rgba(0,0,0,.35);
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f6f8fc;
      --panel:#ffffff; --panel2:#fefefe;
      --ink:#091220;
      --muted:#2a3c58;
      --line:#dae4f3; --chip:#eef4ff;
      --g1:#6d28d9; --g2:#0891b2; --ok:#118a77;
      --shadow:0 10px 24px rgba(10,25,60,.09);
    }
  }

  /* ===== Base ===== */
  *,*::before,*::after{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Segoe UI,Roboto,Helvetica,Arial;
    -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
  }
  .wrap{max-width:1040px;margin:0 auto;padding:20px}
  header{display:flex;gap:16px;align-items:center;margin:6px 0 18px}
  .logo{width:46px;height:46px;border-radius:50%;
        background:conic-gradient(from 140deg,var(--g1),var(--g2));box-shadow:var(--shadow)}
  h1{margin:0;font-size:clamp(26px,5vw,42px);letter-spacing:-.6px;line-height:1.06}
  .sub{margin-top:8px;color:var(--muted);font-weight:700;font-size:clamp(14px,2.9vw,16px)}

  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));
         border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:var(--shadow)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  @media(max-width:760px){.row{grid-template-columns:1fr}}

  /* ===== Upload slots ===== */
  .slot{position:relative;min-height:300px;border:1px solid var(--line);
        border-radius:16px;background:#0b1221;overflow:hidden;
        display:flex;align-items:end;justify-content:center;padding:16px}
  .slot img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
  .label{position:absolute;left:10px;top:10px;background:var(--chip);color:#eef6ff;
         border:1px solid #ffffff3a;padding:6px 10px;border-radius:999px;font-weight:900;font-size:12px}
  input[type=file]{display:none}
  .btn-up{position:relative;z-index:2;border:none;cursor:pointer;min-height:52px;
          padding:15px 18px;border-radius:13px;font-weight:900;color:#fff;
          background:linear-gradient(135deg,var(--g1),var(--g2));
          width:min(90%,380px);box-shadow:0 10px 22px rgba(50,30,130,.35);font-size:16px}

  /* ===== Status & actions ===== */
  .meter{height:10px;background:#0c1730;border-radius:999px;overflow:hidden;border:1px solid #ffffff24}
  .meter>div{height:100%;width:0%;background:linear-gradient(90deg,#22d3ee,#a78bfa,#22c55e)}
  .muted{color:var(--muted)!important;font-weight:800}

  .actions{display:flex;flex-direction:column;align-items:center;gap:12px;margin:18px 0 8px}
  .btn{width:100%;max-width:600px;border:none;border-radius:14px;padding:17px 20px;
       font-weight:900;cursor:pointer;font-size:clamp(16px,3.8vw,18px)}
  .btn.primary{color:#fff;background:linear-gradient(135deg,var(--g1),var(--g2));box-shadow:0 12px 26px rgba(86,46,200,.36)}
  .btn.success{color:#fff;background:var(--ok);box-shadow:0 12px 24px rgba(22,160,133,.34)}
  .btn:disabled{opacity:.6;cursor:not-allowed}

  /* ===== Result ===== */
  h3{margin:0 0 12px;font-size:clamp(19px,4.5vw,24px);letter-spacing:-.2px}
  h4{margin:0 0 10px;font-size:clamp(17px,4vw,20px)}
  .section{background:linear-gradient(180deg,var(--panel),var(--panel2));
           border:1px solid var(--line);border-radius:16px;padding:18px;margin-top:16px;box-shadow:var(--shadow)}
  .who{border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:12px;background:#0f1b35cc}
  .pill{display:inline-block;font-size:13px;background:var(--chip);color:#f4fbff;
        padding:7px 11px;border-radius:999px;border:1px solid #ffffff3d;font-weight:900}
  .list{padding-left:20px;margin:10px 0}
  .score{display:flex;gap:12px;align-items:center}
  .dot{width:72px;height:72px;border-radius:50%;
       background:radial-gradient(circle at 30% 30%,#b9c4ff,#7c3aed);
       display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:22px}
  .kv{margin-top:10px;line-height:1.65;font-size:16.5px}     /* ë³¸ë¬¸ ë” í¼ */

  b,strong{color:var(--ink);font-weight:900}

  footer{margin:28px 0 10px;color:var(--muted);text-align:center}
  a.mail{color:#9ed2ff;text-decoration:none}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>AI ê´€ìƒê¶í•©</h1>
        <div class="sub">ë‘ ì‚¬ëŒì˜ ì–¼êµ´ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´, ì‹¬ì¸µ ê¶í•© ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤. <span style="opacity:.95">(ì¬ë¯¸ë¡œë§Œ ë³´ì„¸ìš”!)</span></div>
      </div>
    </header>

    <section class="panel">
      <h3>ì‚¬ì§„ ì—…ë¡œë“œ</h3>
      <div class="row" style="margin-top:12px">
        <div class="slot">
          <span class="label">A</span>
          <img id="imgPrevA" alt="" style="display:none">
          <input id="fileA" type="file" accept="image/*" />
          <button id="btnA" class="btn-up">A ì‚¬ì§„ ì—…ë¡œë“œ</button>
        </div>
        <div class="slot">
          <span class="label">B</span>
          <img id="imgPrevB" alt="" style="display:none">
          <input id="fileB" type="file" accept="image/*" />
          <button id="btnB" class="btn-up">B ì‚¬ì§„ ì—…ë¡œë“œ</button>
        </div>
      </div>

      <div style="margin-top:16px">
        <div class="meter"><div id="bar"></div></div>
        <div id="status" class="muted" style="margin-top:8px">ëŒ€ê¸° ì¤‘â€¦</div>
      </div>

      <div class="actions">
        <button id="analyze" class="btn primary">ğŸ”® ê´€ìƒê¶í•© ë¶„ì„í•˜ê¸°</button>
        <button id="shareBtn" class="btn success" disabled>ğŸ“‹ ë¶„ì„ ê²°ê³¼ ë³µì‚¬í•˜ê¸°(ë§í¬)</button>
      </div>
    </section>

    <div id="out"></div>

    <footer>âœ‰ï¸ ë¬¸ì˜: <a class="mail" href="mailto:dongja279@gmail.com">dongja279@gmail.com</a></footer>
  </div>

<script>
/* ===== DOM & state ===== */
const fileA=document.getElementById('fileA'), fileB=document.getElementById('fileB');
const btnA=document.getElementById('btnA'), btnB=document.getElementById('btnB');
const prevA=document.getElementById('imgPrevA'), prevB=document.getElementById('imgPrevB');
const bar=document.getElementById('bar'), statusEl=document.getElementById('status');
const analyzeBtn=document.getElementById('analyze'), shareBtn=document.getElementById('shareBtn');
const out=document.getElementById('out');
let imgA=null,imgB=null,lastResult=null;

/* ===== helpers ===== */
const toDataURL=f=>new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(f);});
btnA.onclick=()=>fileA.click(); btnB.onclick=()=>fileB.click();
fileA.onchange=async e=>{const f=e.target.files?.[0]; if(!f) return; imgA=await toDataURL(f); prevA.src=imgA; prevA.style.display='block';}
fileB.onchange=async e=>{const f=e.target.files?.[0]; if(!f) return; imgB=await toDataURL(f); prevB.src=imgB; prevB.style.display='block';}

/* ===== analyze ===== */
analyzeBtn.onclick=async()=>{
  if(!imgA||!imgB){ alert('A, B ì‚¬ì§„ì„ ëª¨ë‘ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.'); return; }
  try{
    analyzeBtn.disabled=true; shareBtn.disabled=true;
    statusEl.textContent='ë¶„ì„ì¤‘â€¦'; bar.style.width='65%';

    // â€œê·¼ê±° = êµ¬ì²´ ê´€ìƒ íŠ¹ì§•â€ì„ ê°•ì œí•˜ëŠ” íŒíŠ¸(ì„œë²„ê°€ í™œìš©í•˜ë©´ í’ˆì§ˆâ†‘)
    const promptHints = `
- 'ê·¼ê±°'ì—ëŠ” ìµœì†Œ 2~3ê°œì˜ êµ¬ì²´ ê´€ìƒ íŠ¹ì§•ì„ ì ìœ¼ì„¸ìš” (ì˜ˆ: ì´ë§ˆê°€ ë„“ê³  ë§¤ëˆí•¨, ì½§ëŒ€ê°€ ê³§ê³  ì½§ëì´ ë‘¥ê¸€ë‹¤, ëˆˆê¼¬ë¦¬ê°€ ì•½ê°„ ì˜¬ë¼ê°€ ë°ì€ ì¸ìƒ, ì…ê¼¬ë¦¬ ìƒìŠ¹, ê·“ë¶ˆì´ ë‘íˆ¼, í„±ì„ ì´ ë¶€ë“œëŸ½ë‹¤/ê°ì§€ë‹¤ ë“±).
- 'ê²°ë¡ 'ì€ ê·¸ ê´€ìƒ íŠ¹ì§•ì´ ì™œ í•´ë‹¹ ìš´(ì¬ë¬¼/ì—°ì• /ê±´ê°•)ìœ¼ë¡œ ì—°ê²°ë˜ëŠ”ì§€ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½.
- íŒì€ 1~2ê°œ ê°„ë‹¨ ì‹¤ì²œë¬¸.
- ì¤‘ë³µ í‘œí˜„ ê¸ˆì§€. Aì™€ Bì˜ ê·¼ê±°ëŠ” ì„œë¡œ ë‹¤ë¥¸ íŠ¹ì§•ì„ ì‚¬ìš©.
`;

    const r=await fetch('/api/match',{
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ imgA, imgB, promptHints })
    });
    if(!r.ok) throw new Error(await r.text());
    const data=await r.json();

    // í”„ë¡ íŠ¸ â€œì•ˆì „ë¬¸êµ¬ fallbackâ€ ì œê±°: ëª¨ë¸ì´ ì•ˆ ì£¼ë©´ ê·¸ëŒ€ë¡œ ë¹„ì›Œë‘  (ì¤‘ë³µë¬¸êµ¬ ë°©ì§€)
    lastResult=data;
    out.innerHTML=renderAll(data);
    statusEl.textContent='ë¶„ì„ì™„ë£Œ!'; bar.style.width='100%';
    shareBtn.disabled=false;
    window.scrollTo({top:out.offsetTop-10,behavior:'smooth'});
  }catch(e){
    alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); statusEl.textContent='ì˜¤ë¥˜'; bar.style.width='0%';
  }finally{
    analyzeBtn.disabled=false;
  }
};

/* ===== share short link ===== */
shareBtn.onclick=async()=>{
  try{
    if(!lastResult){ alert('ë¨¼ì € ë¶„ì„ì„ ì™„ë£Œí•´ ì£¼ì„¸ìš”.'); return; }
    const r=await fetch('/api/share',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({result:lastResult})});
    if(!r.ok) throw new Error(await r.text());
    const {id}=await r.json();
    const url=`${location.origin}/v?id=${id}`;
    await navigator.clipboard.writeText(url);
    shareBtn.textContent='âœ… ë§í¬ ë³µì‚¬ë¨';
    setTimeout(()=>shareBtn.textContent='ğŸ“‹ ë¶„ì„ ê²°ê³¼ ë³µì‚¬í•˜ê¸°(ë§í¬)',1200);
    if(navigator.share){ try{ await navigator.share({title:'AI ê´€ìƒê¶í•© ê²°ê³¼',url}); }catch{} }
  }catch(e){ alert('ë§í¬ ìƒì„± ì‹¤íŒ¨: '+(e?.message||e)); }
};

/* ===== renderers ===== */
const S=v=>v==null?'':String(v);
const L=a=>(Array.isArray(a)?a:[a]).filter(Boolean).map(x=>`<li>${S(x)}</li>`).join('');

function fortuneBox(title,f){
  if(!f) return '';
  return `
    <div class="section">
      <span class="pill">${title}</span>
      ${f.reason  ? `<div class="kv"><strong>ê·¼ê±°:</strong> ${S(f.reason)}</div>` : ''}
      ${f.verdict ? `<div class="kv"><strong>ê²°ë¡ :</strong> ${S(f.verdict)}</div>` : ''}
      ${(f.tips&&f.tips.length)? `<ul class="list">${L(f.tips)}</ul>`:''}
    </div>`;
}
function personBlock(label,p){
  const F=p?.fortune||{};
  return `<div class="who">
    <h4>${label}</h4>
    ${fortuneBox('ì¬ë¬¼ìš´', F.wealth)}
    ${fortuneBox('ì—°ì• ìš´', F.love)}
    ${fortuneBox('ê±´ê°•ìš´', F.health)}
  </div>`;
}
function compatBlock(title,data){
  return `<div class="section">
    <div class="score"><div class="dot">${S(data?.score??0)}</div><h3 style="margin:0">${title}</h3></div>
    <div class="kv" style="margin-top:10px"><strong>ì˜ ë§ëŠ” ì </strong></div>
    <ul class="list">${L(data?.strengths||[])}</ul>
    <div class="kv" style="margin-top:6px"><strong>ì¡°ì‹¬í•´ì•¼ í•  ì </strong></div>
    <ul class="list">${L(data?.cautions||[])}</ul>
  </div>`;
}
function renderAll(d){
  return `
    <div class="section"><h3>ğŸ‘¤ ê°œì¸ë³„ ê´€ìƒ íŠ¹ì§• & ìš´ì„¸</h3>
      ${personBlock('A', d.personA||{})}
      ${personBlock('B', d.personB||{})}
    </div>
    ${compatBlock('ğŸ’– ì—°ì• /ìš°ì •', d?.compatibility?.love_friendship||{})}
    ${compatBlock('ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤', d?.compatibility?.business||{})}
  `;
}

/* ===== open shared link ===== */
(()=>{ const id=new URLSearchParams(location.search).get('id');
  if(!id) return;
  fetch(`/api/get?id=${encodeURIComponent(id)}`).then(r=>r.ok?r.json():Promise.reject())
  .then(d=>{ lastResult=d; out.innerHTML=renderAll(d);
    document.querySelector('.panel').style.display='none';
    statusEl.textContent='ë¶„ì„ì™„ë£Œ!'; bar.style.width='100%';
    window.scrollTo({top:out.offsetTop-10,behavior:'smooth'}); })
  .catch(()=>{});
})();
</script>
</body>
</html>