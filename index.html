<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI ê´€ìƒê¶í•©</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    /* ê³ ëŒ€ë¹„ íŒ”ë ˆíŠ¸ â€“ ëª¨ë°”ì¼ ê°€ë…ì„± ê°•í™” */
    --bg:#0a1120; --panel:#0e172a; --panel2:#0b1426;
    --ink:#f2f7ff; --ink-strong:#ffffff; --ink-stronger:#ffffff;
    --muted:#e7efff; --line:#23314e;
    --accent:#7c3aed; --accent2:#22d3ee; --ok:#10b981; --warn:#f59e0b;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f6f8fc; --panel:#ffffff; --panel2:#ffffff;
      --ink:#0b1320; --ink-strong:#000; --ink-stronger:#000;
      --muted:#1a2742; --line:#e7edf5;
      --accent:#6d28d9; --accent2:#0891b2; --ok:#059669; --warn:#b45309;
    }
  }

  *{box-sizing:border-box}
  html,body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",Segoe UI,Roboto,Helvetica,Arial;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    text-rendering:optimizeLegibility;
  }
  .wrap{max-width:1040px;margin:0 auto;padding:16px}

  /* í—¤ë”: ì™„ì „ ë¶ˆíˆ¬ëª…, í…ìŠ¤íŠ¸ ê°•í•˜ê²Œ */
  header{
    position:sticky;top:0;z-index:5;
    background:linear-gradient(90deg,#0b1323,#081024);
    border-bottom:1px solid #ffffff26;box-shadow:0 8px 20px #0007
  }
  .brand{display:flex;gap:12px;align-items:center;padding:16px 8px}
  .logo{width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent));box-shadow:0 6px 18px #000a}
  .brand h1{margin:0;font-size:22px;font-weight:900;letter-spacing:.2px;color:var(--ink-stronger);text-shadow:0 1px 0 #0008}
  .brand p{margin:4px 0 0;color:var(--ink-strong);font-weight:800;opacity:1}

  /* ê³µí†µ íŒ¨ë„/ì¹´ë“œ */
  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));
    border:1px solid var(--line);border-radius:16px;padding:16px}
  .grid{display:grid;gap:16px}
  @media(min-width:960px){ .grid{grid-template-columns:1fr 1fr} }
  h2.section-title{
    margin:0 0 12px;font-size:22px;font-weight:900;color:var(--ink-stronger)
  }

  /* ì—…ë¡œë” */
  .slot{position:relative;border:1px dashed #5c6b85;background:#0b1424;border-radius:16px;padding:10px}
  .slot .preview{
    display:block;width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:12px;
    border:1px solid #1e2a40;background:#0b1424;color:transparent /* alt/ì•„ì´ì½˜ ë³´ì´ì§€ ì•Šê²Œ */
  }
  .slot .choose{position:absolute;left:50%;bottom:14px;transform:translateX(-50%);
    padding:12px 18px;border-radius:12px;border:1px solid #ffffff40;
    background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;font-weight:900;cursor:pointer}
  input[type=file]{display:none}

  /* ì§„í–‰ë¥  */
  .meter{height:12px;border-radius:999px;background:#0d1628;border:1px solid #182a48;overflow:hidden}
  .meter>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent2),var(--accent))}
  .status{margin-top:8px;color:var(--ink-stronger);font-weight:900;font-size:15px}

  /* ë²„íŠ¼ */
  .actions{display:flex;gap:12px;justify-content:center;margin-top:16px;flex-wrap:wrap}
  .btn{border:none;border-radius:14px;padding:14px 18px;font-weight:900;cursor:pointer;transition:.2s}
  .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;min-width:240px}
  .btn.secondary{background:#193048; border:1px solid #2a3b5b;color:#f7fbff;min-width:260px}
  .btn:disabled{opacity:.55;cursor:not-allowed}

  /* ê²°ê³¼ ì¹´ë“œ (ì œëª©/ì†Œì œëª© ì§„í•˜ê²Œ) */
  .card{background:#0e1728;border:1px solid #22324f;border-radius:16px;padding:16px;margin-top:12px;color:#f7fbff}
  .row{display:flex;gap:12px;align-items:center;margin-bottom:10px}
  .scoreBadge{min-width:72px;height:72px;border-radius:50%;
    background:radial-gradient(70% 70% at 30% 30%,#a78bfa 0%,#60a5fa 60%,#22d3ee 100%);
    display:flex;align-items:center;justify-content:center;
    color:#fff;font-weight:900;font-size:24px;box-shadow:0 6px 18px #0009;margin-right:12px}
  .title-strong{font-weight:900;color:var(--ink-stronger);font-size:18px}

  .mini{background:#0d1426;border:1px solid #1e2d4a;border-radius:14px;padding:14px;margin-top:12px}
  .mini h4{margin:0 0 10px;font-size:16px;font-weight:900;color:var(--ink-stronger)}
  .mini .reason,.mini .verdict{font-weight:900;color:#ffffff}
  .list{margin:6px 0 0 0;padding:0 0 0 18px}
  .list li{margin:7px 0}

  .pill{display:inline-block;border-radius:999px;border:1px solid #2a3a5c;background:#0f1a31;padding:6px 10px;color:#fff;font-weight:900}

  /* í•˜ë‹¨ ê³µìœ  ì˜ì—­ */
  .shareArea{margin-top:18px;text-align:center}
  .shareArea .btn{min-width:260px}

  footer{margin:26px 0;color:#cfe1ff;text-align:center}
  footer a{color:#fff;font-weight:900}

  /* ëª¨ë°”ì¼ íƒ€ì´í¬ ë³´ê°• */
  @media (max-width:480px){
    .brand h1{font-size:20px}
    .brand p{font-size:14px}
    h2.section-title{font-size:20px}
    .title-strong{font-size:17px}
    .mini h4{font-size:15px}
    .status{font-size:14px}
  }
</style>
</head>
<body>
<header>
  <div class="wrap brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>AI ê´€ìƒê¶í•©</h1>
      <p>ë‘ ì‚¬ëŒì˜ ì–¼êµ´ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´, ì‹¬ì¸µ ê¶í•© ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤. (ì¬ë¯¸ë¡œë§Œ ë³´ì„¸ìš”!)</p>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- ì—…ë¡œë“œ -->
  <section class="panel">
    <h2 class="section-title">ì‚¬ì§„ ì—…ë¡œë“œ</h2>
    <div class="grid">
      <div class="slot">
        <img id="prevA" class="preview" alt="" />
        <input id="fileA" type="file" accept="image/*" />
        <button id="pickA" class="choose">A ì‚¬ì§„ ì—…ë¡œë“œ</button>
      </div>
      <div class="slot">
        <img id="prevB" class="preview" alt="" />
        <input id="fileB" type="file" accept="image/*" />
        <button id="pickB" class="choose">B ì‚¬ì§„ ì—…ë¡œë“œ</button>
      </div>
    </div>

    <div style="margin-top:14px">
      <div class="meter"><div id="bar"></div></div>
      <div id="status" class="status">ëŒ€ê¸° ì¤‘â€¦</div>
    </div>

    <div class="actions">
      <button id="analyze" class="btn primary">ğŸ”® ê´€ìƒê¶í•© ë¶„ì„í•˜ê¸°</button>
    </div>
  </section>

  <!-- ë‘ê´„ì‹ í•˜ì´ë¼ì´íŠ¸ -->
  <section id="hi" class="panel" style="margin-top:16px;display:none">
    <h2 class="section-title">ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸</h2>

    <div id="loveCard" class="card">
      <div class="row">
        <div class="scoreBadge" id="loveScore">â€“</div>
        <div>
          <div class="title-strong">ğŸ’– ì—°ì• /ìš°ì • ê¶í•©</div>
          <div id="loveSummary" style="font-weight:800;color:#fff">ë¶„ì„ ì¤‘â€¦</div>
        </div>
      </div>
      <div class="mini">
        <h4>ì˜ ë§ëŠ” ì </h4>
        <ul id="loveStrengths" class="list"></ul>
        <h4 style="margin-top:10px">ì¡°ì‹¬í•´ì•¼ í•  ì </h4>
        <ul id="loveCautions" class="list"></ul>
      </div>
    </div>

    <div id="bizCard" class="card">
      <div class="row">
        <div class="scoreBadge" id="bizScore">â€“</div>
        <div>
          <div class="title-strong">ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê¶í•©</div>
          <div id="bizSummary" style="font-weight:800;color:#fff">ë¶„ì„ ì¤‘â€¦</div>
        </div>
      </div>
      <div class="mini">
        <h4>ì˜ ë§ëŠ” ì </h4>
        <ul id="bizStrengths" class="list"></ul>
        <h4 style="margin-top:10px">ì¡°ì‹¬í•´ì•¼ í•  ì </h4>
        <ul id="bizCautions" class="list"></ul>
      </div>
    </div>
  </section>

  <!-- ê°œì¸ë³„ -->
  <section id="persons" class="panel" style="margin-top:16px;display:none">
    <h2 class="section-title">ğŸ‘¤ ê°œì¸ë³„ ê´€ìƒ íŠ¹ì§• & ìš´ì„¸</h2>

    <div id="personA" class="card">
      <div class="row"><span class="pill">A</span><span style="font-weight:900;color:#fff">ê´€ìƒ ê¸°ë°˜ ìš´ì„¸</span></div>
      <div id="aFortunes"></div>
    </div>

    <div id="personB" class="card">
      <div class="row"><span class="pill">B</span><span style="font-weight:900;color:#fff">ê´€ìƒ ê¸°ë°˜ ìš´ì„¸</span></div>
      <div id="bFortunes"></div>
    </div>

    <!-- ê²°ê³¼ í•˜ë‹¨ ê³µìœ  ë²„íŠ¼ -->
    <div class="shareArea">
      <button id="shareBtn" class="btn secondary" disabled>ğŸ—‚ï¸ ê³µìœ  ë§í¬ ë³µì‚¬</button>
    </div>
  </section>

  <footer>Â© 2025 AI ê´€ìƒê¶í•© Â· ë¬¸ì˜: <a href="mailto:dongja279@gmail.com">dongja279@gmail.com</a></footer>
</main>

<script>
  // ìš”ì†Œ
  const pickA=document.getElementById('pickA'), pickB=document.getElementById('pickB');
  const fileA=document.getElementById('fileA'), fileB=document.getElementById('fileB');
  const prevA=document.getElementById('prevA'), prevB=document.getElementById('prevB');
  const analyzeBtn=document.getElementById('analyze'), shareBtn=document.getElementById('shareBtn');
  const bar=document.getElementById('bar'), statusEl=document.getElementById('status');
  const hiSec=document.getElementById('hi'), personsSec=document.getElementById('persons');

  const loveScore=document.getElementById('loveScore'), loveSummary=document.getElementById('loveSummary');
  const loveStrengths=document.getElementById('loveStrengths'), loveCautions=document.getElementById('loveCautions');
  const bizScore=document.getElementById('bizScore'), bizSummary=document.getElementById('bizSummary');
  const bizStrengths=document.getElementById('bizStrengths'), bizCautions=document.getElementById('bizCautions');
  const aFortunes=document.getElementById('aFortunes'), bFortunes=document.getElementById('bFortunes');

  // íŒŒì¼ ì²˜ë¦¬
  const readAsDataURL = f => new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(f); });
  pickA.onclick=()=>fileA.click(); pickB.onclick=()=>fileB.click();
  let imgA=null,imgB=null;
  fileA.onchange=async e=>{const f=e.target.files?.[0]; if(!f) return; imgA=await readAsDataURL(f); prevA.src=imgA;}
  fileB.onchange=async e=>{const f=e.target.files?.[0]; if(!f) return; imgB=await readAsDataURL(f); prevB.src=imgB;}

  // ì§„í–‰ë¥ 
  function startProgress(){
    shareBtn.disabled=true; hiSec.style.display='none'; personsSec.style.display='none';
    statusEl.textContent='ë¶„ì„ ì¤€ë¹„ ì¤‘â€¦'; bar.style.width='0%';
    let p=0; const t=setInterval(()=>{ p+=Math.floor(Math.random()*12)+8; if(p>=96)p=96; bar.style.width=p+'%'; statusEl.textContent=p+'% ë¶„ì„ ì¤‘â€¦'; },450);
    return ()=>clearInterval(t);
  }
  function finishProgress(){ bar.style.width='100%'; statusEl.textContent='ë¶„ì„ ì™„ë£Œ!'; }

  // ë Œë” ìœ í‹¸
  const li = s => `<li>${String(s||'')}</li>`;
  const listHtml = a => (a||[]).map(li).join('');
  const mini = (title,obj)=>`
    <div class="mini">
      <h4>${title}</h4>
      <div class="reason"><b>ê·¼ê±°:</b> ${String(obj?.reason||'')}</div>
      <div class="verdict"><b>ê²°ë¡ :</b> ${String(obj?.verdict||'')}</div>
      ${(obj?.tips?.length? `<ul class="list">${listHtml(obj.tips)}</ul>`:'')}
    </div>`;
  function renderPersons(pA,pB){
    aFortunes.innerHTML= mini('ğŸ’° ì¬ë¬¼ìš´',pA?.wealth)+mini('ğŸ’– ì—°ì• ìš´',pA?.love)+mini('ğŸ’ª ê±´ê°•ìš´',pA?.health);
    bFortunes.innerHTML= mini('ğŸ’° ì¬ë¬¼ìš´',pB?.wealth)+mini('ğŸ’– ì—°ì• ìš´',pB?.love)+mini('ğŸ’ª ê±´ê°•ìš´',pB?.health);
  }
  function renderHighlights(d){
    const L=d?.compatibility?.love_friendship||{}, B=d?.compatibility?.business||{};
    loveScore.textContent=(L.score??'â€“'); loveSummary.textContent=L.summary||' ';
    loveStrengths.innerHTML=listHtml(L.strengths); loveCautions.innerHTML=listHtml(L.cautions);
    bizScore.textContent=(B.score??'â€“'); bizSummary.textContent=B.summary||' ';
    bizStrengths.innerHTML=listHtml(B.strengths); bizCautions.innerHTML=listHtml(B.cautions);
  }

  // ê³µìœ  ë§í¬ ìƒì„± â€“ í•­ìƒ share.html ë¡œ
  async function createShareLink(payload){
    // ì„œë²„ê°€ ë¬¸ìì—´/JSON ì–´ë–¤ ê±¸ ë°›ì•„ë„ ë˜ë„ë¡ ì•ˆì „ ì²˜ë¦¬
    let bodyData;
    if (typeof payload === 'string') {
      bodyData = payload;
    } else {
      try { bodyData = JSON.stringify(payload); }
      catch { bodyData = String(payload); }
    }
    const res = await fetch('/api/share',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ data: bodyData, type:'match' })
    });
    const text = await res.text();
    let json; try{ json = JSON.parse(text); }catch{ json = {error:text}; }
    if(!res.ok) throw new Error(json?.error || 'ê³µìœ  ë§í¬ ìƒì„± ì‹¤íŒ¨');

    // APIê°€ urlì„ ì£¼ë©´ ê·¸ëŒ€ë¡œ ì“°ê³ , ì•„ë‹ˆë©´ idë¡œ share.html êµ¬ì„±
    const gotUrl = json?.url;
    if (gotUrl) {
      try {
        // ë£¨íŠ¸ë¡œ ë°˜í™˜ëœ ê²½ìš°ë„ share.htmlë¡œ ê°•ì œ êµì²´
        const u = new URL(gotUrl);
        u.pathname = '/share.html';
        return u.toString();
      } catch { /* ê·¸ëƒ¥ ì•„ë˜ë¡œ */ }
    }
    const id = json?.id || json?.key || json?.k;
    if (!id && !gotUrl) throw new Error('ì„œë²„ ì‘ë‹µì— id/url ì—†ìŒ');
    return gotUrl || `${location.origin}/share.html?r=${encodeURIComponent(id)}`;
  }

  // ë¶„ì„ ì‹¤í–‰
  analyzeBtn.onclick=async ()=>{
    if(!imgA||!imgB){alert('A, B ì‚¬ì§„ì„ ëª¨ë‘ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.');return;}
    const stop=startProgress(); analyzeBtn.disabled=true;
    try{
      const res=await fetch('/api/match',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({imgA,imgB})});
      const txt=await res.text();
      let data; try{ data=JSON.parse(txt); }catch(e){ throw new Error('ê²°ê³¼ íŒŒì‹± ì‹¤íŒ¨'); }
      if(!res.ok) throw new Error(data?.error||'ë¶„ì„ ì‹¤íŒ¨');

      renderHighlights(data); renderPersons(data.personA,data.personB);
      hiSec.style.display=''; personsSec.style.display=''; stop(); finishProgress();

      shareBtn.disabled=false;
      shareBtn.onclick=async()=>{
        try{
          shareBtn.disabled=true; shareBtn.textContent='ë§í¬ ìƒì„± ì¤‘â€¦';
          const url=await createShareLink(data);
          await navigator.clipboard.writeText(url);
          shareBtn.textContent='âœ… ë§í¬ ë³µì‚¬ë¨';
          setTimeout(()=>{shareBtn.textContent='ğŸ—‚ï¸ ê³µìœ  ë§í¬ ë³µì‚¬'; shareBtn.disabled=false;},1500);
        }catch(e){
          alert('ë§í¬ ìƒì„± ì‹¤íŒ¨: '+(e?.message||e));
          shareBtn.textContent='ğŸ—‚ï¸ ê³µìœ  ë§í¬ ë³µì‚¬'; shareBtn.disabled=false;
        }
      };
    }catch(e){
      stop(); finishProgress();
      alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n'+(e?.message||e));
    }finally{
      analyzeBtn.disabled=false;
    }
  };
</script>
</body>
</html>
