<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI ê´€ìƒê¶í•© â€” ê³µìœ  ê²°ê³¼</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --panel2:#0d1628;
    --ink:#ffffff; --muted:#cfe1ff; --sub:#e7efff;
    --accent:#7c3aed; --accent2:#22d3ee; --line:#20314d;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f6f8fc; --panel:#ffffff; --panel2:#ffffff;
      --ink:#0b1320; --muted:#24324a; --sub:#1b2740; --line:#e7edf5;
      --accent:#6d28d9; --accent2:#0891b2;
    }
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    text-rendering:optimizeLegibility;
    font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1040px;margin:0 auto;padding:16px}

  header{position:sticky;top:0;z-index:5;
    background:linear-gradient(90deg,#0b1323,#081024);
    border-bottom:1px solid #ffffff22;box-shadow:0 6px 18px #0006}
  .brand{display:flex;gap:12px;align-items:center;padding:14px 8px}
  .logo{width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,var(--accent2),var(--accent));box-shadow:0 6px 18px #0008}
  .brand h1{margin:0;font-size:22px;font-weight:900;letter-spacing:.2px;color:#fff}
  .brand p{margin:2px 0 0;color:#e8f2ff;font-weight:700}

  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));
    border:1px solid var(--line);border-radius:16px;padding:16px}
  .card{background:#0e1728;border:1px solid #22324f;border-radius:16px;padding:14px;margin-top:12px;color:#eaf2ff}
  .list{margin:6px 0 0 0;padding:0 0 0 18px}
  .list li{margin:6px 0}
  .row{display:flex;gap:12px;align-items:center;margin-bottom:6px}
  .pill{display:inline-block;border-radius:999px;border:1px solid #2a3a5c;background:#0f1a31;padding:6px 10px;color:#dfe7fb;font-weight:800}

  .scoreBadge{min-width:72px;height:72px;border-radius:50%;
    background:radial-gradient(70% 70% at 30% 30%,#a78bfa 0%,#60a5fa 60%,#22d3ee 100%);
    display:flex;align-items:center;justify-content:center;
    color:#fff;font-weight:900;font-size:26px;box-shadow:0 8px 22px #0008;margin-right:12px}

  .mini{background:#0d1426;border:1px solid #1e2d4a;border-radius:14px;padding:12px;margin-top:12px}
  .mini h4{margin:0 0 8px;font-size:16px;font-weight:900;color:#fff}
  .mini .reason,.mini .verdict{font-weight:800}
  .mini .tips{margin:8px 0 0 16px}

  /* ëª¨ë°”ì¼ì—ì„œ ì œëª© ê°€ë…ì„± ê°•í™”: ì§„í•œ ë¸”ë™, ì•½ê°„ì˜ í…ìŠ¤íŠ¸ ê·¸ë¦¼ì */
  h2.section-title{
    margin:0 0 10px;font-size:22px;font-weight:900;color:#000 !important;
    text-shadow:0 1px 0 rgba(255,255,255,.25);
  }

  .fade-in{opacity:0;transform:translateY(8px);animation:fadein .55s ease-out forwards}
  @keyframes fadein{to{opacity:1;transform:none}}

  footer{margin:20px 0;color:#cfe1ff;text-align:center}
  footer a{color:#fff;font-weight:800}

  .error{background:#2b0e14;color:#ffd7db;border:1px solid #5d1b27;padding:14px;border-radius:12px;font-weight:800}
</style>
</head>
<body>
<header>
  <div class="wrap brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>AI ê´€ìƒê¶í•© â€” ê³µìœ  ê²°ê³¼</h1>
      <p>ì¹œêµ¬ì—ê²Œ ê³µìœ ëœ ê´€ìƒ ê¶í•© ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤. (ì˜¤ë½/ì°¸ê³ ìš©)</p>
    </div>
  </div>
</header>

<main class="wrap" id="app">
  <section id="errorBox" class="panel" style="display:none">
    <div class="error" id="errMsg">ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
  </section>

  <!-- í•˜ì´ë¼ì´íŠ¸ -->
  <section id="hi" class="panel fade-in" style="display:none;margin-top:16px">
    <h2 class="section-title">ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸</h2>

    <div id="loveCard" class="card">
      <div class="row">
        <div class="scoreBadge" id="loveScore">â€“</div>
        <div>
          <div style="font-weight:900">ğŸ’– ì—°ì• /ìš°ì • ê¶í•©</div>
          <div id="loveSummary" style="opacity:.85">â€”</div>
        </div>
      </div>
      <div class="mini">
        <h4>ì˜ ë§ëŠ” ì </h4>
        <ul id="loveStrengths" class="list"></ul>
        <h4 style="margin-top:10px">ì¡°ì‹¬í•´ì•¼ í•  ì </h4>
        <ul id="loveCautions" class="list"></ul>
      </div>
    </div>

    <div id="bizCard" class="card">
      <div class="row">
        <div class="scoreBadge" id="bizScore">â€“</div>
        <div>
          <div style="font-weight:900">ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê¶í•©</div>
          <div id="bizSummary" style="opacity:.85">â€”</div>
        </div>
      </div>
      <div class="mini">
        <h4>ì˜ ë§ëŠ” ì </h4>
        <ul id="bizStrengths" class="list"></ul>
        <h4 style="margin-top:10px">ì¡°ì‹¬í•´ì•¼ í•  ì </h4>
        <ul id="bizCautions" class="list"></ul>
      </div>
    </div>
  </section>

  <!-- ê°œì¸ë³„ -->
  <section id="persons" class="panel fade-in" style="display:none;margin-top:16px">
    <h2 class="section-title">ğŸ‘¤ ê°œì¸ë³„ ê´€ìƒ íŠ¹ì§• & ìš´ì„¸</h2>

    <div id="personA" class="card">
      <div class="row"><span class="pill">A</span><span style="opacity:.85">ê´€ìƒ ê¸°ë°˜ ìš´ì„¸</span></div>
      <div id="aFortunes"></div>
    </div>

    <div id="personB" class="card">
      <div class="row"><span class="pill">B</span><span style="opacity:.85">ê´€ìƒ ê¸°ë°˜ ìš´ì„¸</span></div>
      <div id="bFortunes"></div>
    </div>
  </section>

  <footer>Â© 2025 AI ê´€ìƒê¶í•© Â· ë¬¸ì˜: <a href="mailto:dongja279@gmail.com">dongja279@gmail.com</a></footer>
</main>

<script>
  const $ = (id)=>document.getElementById(id);
  const hiSec = $('hi'), personsSec = $('persons'), errorBox=$('errorBox'), errMsg=$('errMsg');

  const loveScore=$('loveScore'), loveSummary=$('loveSummary');
  const loveStrengths=$('loveStrengths'), loveCautions=$('loveCautions');
  const bizScore=$('bizScore'), bizSummary=$('bizSummary');
  const bizStrengths=$('bizStrengths'), bizCautions=$('bizCautions');
  const aFortunes=$('aFortunes'), bFortunes=$('bFortunes');

  const li = s => `<li>${String(s||'')}</li>`;
  const listHtml = a => (a||[]).map(li).join('');
  function mini(title,obj){
    return `<div class="mini">
      <h4>${title}</h4>
      <div class="reason"><b>ê·¼ê±°:</b> ${String(obj?.reason||'')}</div>
      <div class="verdict"><b>ê²°ë¡ :</b> ${String(obj?.verdict||'')}</div>
      ${(obj?.tips?.length? `<ul class="tips">${listHtml(obj.tips)}</ul>`:'')}
    </div>`;
  }
  function renderPersons(pA,pB){
    aFortunes.innerHTML= mini('ğŸ’° ì¬ë¬¼ìš´',pA?.wealth)+mini('ğŸ’– ì—°ì• ìš´',pA?.love)+mini('ğŸ’ª ê±´ê°•ìš´',pA?.health);
    bFortunes.innerHTML= mini('ğŸ’° ì¬ë¬¼ìš´',pB?.wealth)+mini('ğŸ’– ì—°ì• ìš´',pB?.love)+mini('ğŸ’ª ê±´ê°•ìš´',pB?.health);
  }
  function renderHighlights(d){
    const L=d?.compatibility?.love_friendship||{}, B=d?.compatibility?.business||{};
    loveScore.textContent=(L.score??'â€“'); loveSummary.textContent=L.summary||'â€”';
    loveStrengths.innerHTML=listHtml(L.strengths); loveCautions.innerHTML=listHtml(L.cautions);
    bizScore.textContent=(B.score??'â€“'); bizSummary.textContent=B.summary||'â€”';
    bizStrengths.innerHTML=listHtml(B.strengths); bizCautions.innerHTML=listHtml(B.cautions);
  }

  function getParam(name){
    const m = new URL(location.href).searchParams.get(name);
    return m ? decodeURIComponent(m) : '';
  }

  async function loadAndRender(){
    const id = getParam('r');
    if(!id){ errorBox.style.display=''; errMsg.textContent='ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'; return; }

    try{
      const r = await fetch(`/api/load?id=${encodeURIComponent(id)}`);
      const j = await r.json();

      if(!r.ok || !j?.ok || !j?.data){
        errorBox.style.display=''; errMsg.textContent=j?.error || 'ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'; return;
      }

      let data = j.data;

      // í˜¹ì‹œë¼ë„ ì´ì¤‘ ë˜í•‘ì´ ë‚¨ì•„ìˆìœ¼ë©´ ìµœì¢… ë°©ì–´
      if (data && typeof data === 'object' && 'value' in data) {
        try { data = JSON.parse(data.value); } catch {}
      }

      renderHighlights(data);
      renderPersons(data.personA, data.personB);

      errorBox.style.display='none';
      hiSec.style.display=''; personsSec.style.display='';
    }catch(e){
      errorBox.style.display='';
      errMsg.textContent='ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      console.error(e);
    }
  }

  // ì‹œì‘
  loadAndRender();
</script>
</body>
</html>
